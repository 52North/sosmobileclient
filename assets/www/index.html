<!doctype html>
<html>
  <head>
  	<meta charset="utf-8">
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  	<title>Mobile SensorWebClient</title>
  	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <link rel="stylesheet" href="css/font-awesome.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/rickshaw.min.css">
    <link rel="stylesheet" href="css/mfmobilepages.css">
    <link rel="stylesheet/less" href="css/style.less">
    <style type="text/css">
      *, *:after, *:before { -webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box; }
      body, html {
        padding: 0;
        margin: 0;
        height: 100%;
      }

      /* Clearfix hack by Nicolas Gallagher: http://nicolasgallagher.com/micro-clearfix-hack/ */
      .clearfix:before, .clearfix:after { content: " "; display: table; }
      .clearfix:after { clear: both; }

      body {
        background: #fff;
        overflow: hidden;
      }
    </style>
    <!-- Modernizer -->
    <script src="js/libs/modernizr.custom.js"></script>
  </head>
  <body>
    <div id="global-modals"></div>
    <div id="temp-modals"></div>

    <div id="pt-main" class="pt-perspective">
      <div class="mf-panel"  data-alignment="left" id="legend-panel">
        <header role="banner" class="top app-navbar">
          <a class="nav-btn nav-btn-right" href="javascript:history.back()"><i class="icon-remove"></i></a>
          <h1>Legend</h1>
        </header>
        <div class="full-content" id="legend-content"></div>
      </div>

      <div class="pt-page" data-alignment="left" id="chart-page">
        <header role="banner" class="top app-navbar">
          <a class="nav-btn nav-btn-left page-btn" href="#legend" ><i class="icon-th-list"></i></a>
          <h1>Chart View</h1>
          <a class="nav-btn nav-btn-right page-btn" href="#add"><i class="icon-plus"></i></a>
        </header>
        <div class="content" id="chart-content">
        </div>
      </div>

      <div class="pt-page" data-alignment="right" id="add-page">
         <header role="banner" class="top app-navbar">
          <a class="nav-btn nav-btn-left page-btn" href="#chart"><i class="icon-bar-chart"></i></a>
          <h1><i class="icon-plus"></i> Add</h1>
          <a class="nav-btn nav-btn-right page-btn" href="#settings"><i class="icon-cogs"></i></a>
        </header>
        <div id="add-content" class="content" ></div>
      </div>

      <div class="mf-panel" data-alignment="right" id="settings-panel">
        <header role="banner" class="top app-navbar">
          <a class="nav-btn nav-btn-left" href="javascript:history.back()"><i class="icon-remove"></i></a>
          <h1></h1>
        </header>
        <div class="full-content" id="settings-content">
        </div>
      </div>
    </div>


    <!-- JavaScript -->
    <!-- 3. Party -->
    <script src="js/libs/jquery-1.7.2.min.js"></script>
    <script src="js/libs/jquery-migrate-1.2.1.js"></script>
    <script src="js/libs/underscore.js"></script>
    <script src="js/libs/backbone-1.0.0.js"></script>
    <script src="js/libs/jquery.geo-1.0b1.min.js"></script>
    <script src="js/libs/less-1.3.3.min.js"></script>
    <script src="js/libs/jquery.total-storage.js"></script>
    <script src="js/libs/mfmobilepages.js"></script>
    <script src="js/libs/handlebars-1.0.0.js"></script>
    <script src="js/libs/backbone-mediator.js"></script>
    <script src="js/libs/rickshaw.min.js"></script>
    <script src="js/libs/d3.v3.min.js"></script>

    <!-- Helpers -->
    <script src="js/helpers/handlebars-helper.js"></script>
    <script src="js/helpers/util.js"></script>
    
    <!-- Phonegap -->
    <script src="js/libs/phonegap/cordova-1.9.0.js"></script>
    <script src="js/libs/phonegap/apis/geolocation.js"></script>
    <script src="js/libs/phonegap/apis/device.js"></script>

    <!-- Bootstrap -->
    <script src="js/libs/bootstrap.js"></script>

    <!-- Router -->
    <script src="js/router.js"></script>

    <!-- Models -->
    <script src="js/models/service.js"></script>
    <script src="js/models/station.js"></script>
    <script src="js/models/current_settings.js"></script>
    <script src="js/models/timeseries.js"></script>
    <script src="js/models/current_timeseries_data.js"></script>
    
    <!-- Collections -->
    <script src="js/collections/services.js"></script>
    <script src="js/collections/stations.js"></script>
    <script src="js/collections/timeseries.js"></script>
    <script src="js/collections/history_timeseries.js"></script>
    <script src="js/collections/current_timeseries.js"></script>

    <!-- Controllers -->
    <script src="js/controllers/add.js"></script>
    <script src="js/controllers/chart.js"></script>

    <!-- Views -->
    <script src="js/views/browser.js"></script>
    <script src="js/views/map.js"></script>
    <script src="js/views/chart.js"></script>
    <script src="js/views/settings.js"></script>
    <script src="js/views/legend.js"></script>
    <script src="js/views/stations.js"></script>
    <script src="js/views/timeseries.js"></script>
    <script src="js/views/history.js"></script>

    <script>
      $(function() {
        //document.addEventListener("deviceready", function() { //wait for phonegap //TURN OFF ON COMPUTER IN DEV MODE!
          jQuery.migrateMute = true;

          //models and collections
          window.settings = new CurrentSettings(); //globally
          stations = new Stations();
          services = new Services();
          timeseriesData = new CurrentTimeseriesData();
          timeseriesData.set('currentTimeseries', new CurrentTimeseries());
          timeseriesData.set('chartSettings', new CurrentSettings());
          window.currentTimeseries = timeseriesData.get('currentTimeseries'); //globally
          historyTimeseries = new HistoryTimeseries();
          historyTimeseries.fetch();

          //views
          new SettingsView({'model': window.settings, 'currentStations': stations, 'availableServices': services}).render();
          new AddController(services, stations, timeseriesData.get('currentTimeseries'), historyTimeseries);
          new ChartController(timeseriesData);

          legend = new LegendView({'collection': timeseriesData.get('currentTimeseries')});
          $('#legend-content').empty().html(legend.render().el)

          //fetching data
          timeseriesData.get('currentTimeseries').fetch();
          window.settings.fetch();
          stations.url = generateStationsUrl(window.settings.get('currentProvider'));
          stations.fetch({reset: true});
          services.fetch();

          //router
          router = new AppRouter();
          Backbone.history.start();

          //No calls after boot
          Backbone.Mediator.publish('app:booted', false);


            data = JSON.stringify({"timeseries": ["ts_46d3a18491aee6ae456bc80733b66903","ts_f8ce3a93a6d7b7634b512cd164345991","ts_60d531379494324f27589573b27acd1c"]});
            console.log(data);
          request = $.ajax( {
            url: 'http://sensorweb.demo.52north.org/sensorwebclient-webapp-stable/api/v0/timeseries',
            type: 'POST',
            data: data,
            headers: {
              "Data-type": 'application/json',
              "Accept": 'application/json'
            }
          });

          request.success(function(data) {
              console.info(data);
          });
          request.fail(function(jqXHR, textStatus) {
            console.log( "Request failed: " + textStatus + "   " + jqXHR.responseText);
            });

        //}, false);
      });

    </script>

    </body>
</html>