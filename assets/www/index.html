<!doctype html>
<html>
  <head>
  	<meta charset="utf-8">
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  	<title>Mobile SensorWebClient</title>
  	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <link rel="stylesheet" href="css/font-awesome.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/leaflet/leaflet.css">
    <link rel="stylesheet" href="css/leaflet/MarkerCluster.css">
    <link rel="stylesheet" href="css/mfmobilepages.css">
    <link rel="stylesheet" href="css/mobiscroll.android-ics.css">
    <link rel="stylesheet" href="css/mobiscroll.animation.css">
    <link rel="stylesheet" href="css/mobiscroll.core.css">
    <!-- DEPLOYMENT
    <link rel="stylesheet/less" href="css/style.less">
    <link rel="stylesheet/less" href="css/map.less">
    -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/map.css">
    <!-- Modernizer -->
    <script src="js/libs/modernizr.custom.js"></script>   
  </head>
  <body>
    <div id="global-modals"></div>
    <div id="temp-modals"></div>

    <div id="pt-main" class="pt-perspective">
      <div class="mf-panel"  data-alignment="left" id="legend-panel">
        <header role="banner" class="top app-navbar">
          <a class="nav-btn nav-btn-right" href="#chart"><i class="icon-remove"></i></a>
          <h1>Legend</h1>
        </header>
        <div class="full-content" id="legend-content"></div>
      </div>

      <div class="pt-page" data-alignment="left" id="chart-page">
        <header role="banner" class="top app-navbar">
          <a class="nav-btn nav-btn-left page-btn" href="#legend" ><i class="icon-th-list"></i></a>
          <h1>Chart</h1>
          <a class="nav-btn nav-btn-right page-btn" href="#add"><i class="icon-plus"></i></a>
        </header>
        <div class="content" id="chart-content">
        </div>
      </div>

      <div class="pt-page" data-alignment="right" id="add-page">
         <header role="banner" class="top app-navbar">
          <a class="nav-btn nav-btn-left page-btn" href="#chart"><i class="icon-bar-chart"></i></a>
          <h1>Catalog</h1>
          <a class="nav-btn nav-btn-right android-menu-btn" href="#add"><i class="icon-cogs"></i></a>
        </header>
        <div id="add-content" class="content" ></div>
      </div>

      <div class="mf-panel"  data-alignment="bottom" id="settings-panel">
      </div>

    </div>

    <!-- JavaScript -->
    <!-- 3. Party -->
      <script src="js/libs/jquery-2.0.3.min.js"></script>
      <script src="js/libs/jquery-migrate-1.2.1.js"></script>
      <script src="js/libs/underscore.js"></script>
      <script src="js/libs/backbone-1.0.0.js"></script>
      <script src="js/libs/leaflet.js"></script> 
      <script src="js/libs/leaflet.markercluster.js"></script> 
      <!-- DEPLOYMENT
      <script src="js/libs/less-1.3.3.min.js"></script>
      -->
      <script src="js/libs/jquery.total-storage.js"></script>
      <script src="js/libs/mfmobilepages.js"></script>
      <script src="js/libs/handlebars-1.0.0.js"></script>
      <script src="js/libs/backbone-mediator.js"></script>
      <script src="js/libs/moment-2.2.1.min.js"></script>
      <script src="js/libs/one-color.js"></script>

      <!-- Flot -->
      <script src="js/libs/flot/jquery.flot.min.js"></script>
      <script src="js/libs/flot/jquery.flot.selection.js"></script> <!-- modified! do not use the min version -->
      <script src="js/libs/flot/jquery.flot.time.min.js"></script>
      <script src="js/libs/touchit-1.0.0.js"></script>
      
      <!-- Phonegap - remove this block when testing in browser -->
      <script src="js/libs/phonegap/cordova-1.9.0.js"></script>
      <script src="js/libs/phonegap/apis/geolocation.js"></script>
      <script src="js/libs/phonegap/apis/device.js"></script>
      
      <script type="text/javascript" src="phonegap.js"></script>
      <script type="text/javascript" src="cordova.js"></script>
      <script type="text/javascript" src="cordova_plugins.js"></script>
      
      <!-- Bootstrap -->
      <script src="js/libs/bootstrap.js"></script>

      <!-- MobiScroll -->
      <script src="js/libs/mobiscroll/mobiscroll.core.js"></script>
      <script src="js/libs/mobiscroll/mobiscroll.datetime.js"></script>
      <script src="js/libs/mobiscroll/mobiscroll.android-ics.js"></script>
      
    <!-- My Modules -->
      <!-- Helpers -->
      <script src="js/helpers/backbone_extensions.js"></script>
      <script src="js/helpers/handlebars_helpers.js"></script>
      <script src="js/helpers/utils.js"></script>
      <script src="js/helpers/color_utils.js"></script>

      <!-- Services -->
      <script src="js/services/storage.js"></script>
      <script src="js/services/android_button.js"></script>
      
      <!-- Router -->
      <script src="js/router.js"></script>

      <!-- Models -->
      <script src="js/models/service.js"></script>
      <script src="js/models/station.js"></script>
      <script src="js/models/current_settings.js"></script>
      <script src="js/models/timeseries.js"></script>
      <script src="js/models/timeseries_data.js"></script>
      
      <!-- Collections -->
      <script src="js/collections/persistent_timeseries.js"></script>
      <script src="js/collections/current_timeseries.js"></script>
      <script src="js/collections/history_timeseries.js"></script>
      <script src="js/collections/services.js"></script>
      <script src="js/collections/stations.js"></script>
      <script src="js/collections/timeseries.js"></script>
      <script src="js/collections/timeseries_data_collection.js"></script>

      <!-- Controllers -->
      <script src="js/controllers/catalog.js"></script>
      <script src="js/controllers/chartController.js"></script>
      <script src="js/controllers/dynamicChartController.js"></script>
      <script src="js/controllers/legend.js"></script>
      <script src="js/controllers/map.js"></script>
      <script src="js/controllers/service.js"></script>
      <script src="js/controllers/staticChartController.js"></script>
      <script src="js/controllers/timeseries.js"></script>

      <!-- Views -->
      <script src="js/views/color.js"></script>
      <script src="js/views/chartControls.js"></script>
      <script src="js/views/chartRangeSettings.js"></script>
      <script src="js/views/dynamicChart.js"></script>
      <script src="js/views/settings.js"></script>
      <script src="js/views/legend.js"></script>
      <script src="js/views/legendTimeserie.js"></script>
      <script src="js/views/loading.js"></script>
      <script src="js/views/map.js"></script>
      <script src="js/views/search.js"></script>
      <script src="js/views/staticChart.js"></script>
      <script src="js/views/stations.js"></script>
      <script src="js/views/timeseries.js"></script>
      <script src="js/views/history.js"></script>
      <script src="js/views/services.js"></script>

    <script>
      $(function() {
        $(document).on("deviceready", function() { //wait for phonegap
          Backbone.Mediator.subscribe('app:booted', function() {
            navigator.splashscreen.hide();
          }, this);
          
          $(document).on("backbutton", function(e) {
            e.preventDefault();
            Backbone.Mediator.publish('device:button:back');
          });
          $(document).on("menubutton", function(e) {
            e.preventDefault();
          });

          Backbone.Mediator.publish('device:ready', false);
        });

        jQuery.migrateMute = true;
  
        window.settings = new CurrentSettings(); //globally
        window.settings.fetch();
        
        //models and collections
        var stations = new Stations();
        var services = new Services();
        var currentTimeseries = new CurrentTimeseries();
        window.currentTimeseries = currentTimeseries;
        var historyTimeseries = new HistoryTimeseries();
        historyTimeseries.fetch();

        //views
        var settingsView = new SettingsView({'model': window.settings, 'el': $('#settings-panel')}).render();

        //controllers
        new CatalogController(services, stations, historyTimeseries, currentTimeseries);
        new ChartController(currentTimeseries);
        new TimeseriesController(currentTimeseries, historyTimeseries);
        new ServiceController(services, stations);
        new LegendController(currentTimeseries);

        //fetching data
        currentTimeseries.fetch();
        stations.url = Helpers.generateStationsUrl(window.settings.get('currentProvider'));
        stations.fetch({reset: true});
        services.fetch();

        //router
        var router = new AppRouter();
        Backbone.history.start();

        //No calls after boot
        Backbone.Mediator.publish('app:booted', false);
      });

    </script>

    </body>
</html>